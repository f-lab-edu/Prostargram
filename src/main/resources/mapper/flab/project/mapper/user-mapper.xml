<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="flab.project.mapper.UserMapper">

    <select id="findAll" parameterType="flab.project.data.enums.requestparam.GetFollowsType" resultType="User">
        SELECT
            U.user_id,
            U.user_name,
            U.profile_img_url,
            O.name
        FROM USERS AS U
        JOIN ORGANIZATION O on U.organization_id = O.organization_id
        <choose>
            <when test='requestType.name().equals("FOLLOWERS")'>
                WHERE user_id IN (
                    SELECT
                        from_user_id
                    FROM FOLLOWS
                    WHERE to_user_id=#{userId}
                );
            </when>
            <when test='requestType.name().equals("FOLLOWINGS")'>
                WHERE user_id IN (
                    SELECT
                        to_user_id
                    FROM FOLLOWS
                    WHERE from_user_id=#{userId}
                );
            </when>
        </choose>
    </select>

    <update id="updateProfile" parameterType="flab.project.data.dto.UpdateProfileRequestDto">
        UPDATE USERS
        <set>
            <if test="updateProfileRequestDto.userName !=null">user_name=#{updateProfileRequestDto.userName},</if>
            <if test="updateProfileRequestDto.departmentName !=null">department_name=#{updateProfileRequestDto.departmentName},</if>
            <if test="updateProfileRequestDto.selfIntroduction !=null">self_introduction=#{updateProfileRequestDto.selfIntroduction}</if>
        </set>
        WHERE user_id=#{userId};
    </update>

</mapper>
